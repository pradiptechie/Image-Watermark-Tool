<!DOCTYPE html>
<html>
<head>
  <title>Image Watermark Tool</title>
<style>
    @import url("https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500;700&display=swap");

    * {
      font-family: "Ubuntu", sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    :root {
        --blue: #2a2185;
        --blue2: #4236ce;
        --white: #fff;
        --gray: #f4f4f4;
        --gray2: #eeecec;
        --black1: #222;
        --black2: #999;
    }

    body {
        background: var(--gray);
        color: var(--black1);
        margin: 0;
        padding: 0;
    }
    table {
      width: 100%; 
      border-collapse: separate;
      border-spacing: 10px;
    }


    h1 {
        text-align: center;
        color: var(--white);
        background: var(--blue);
        padding: 20px;
        margin: 0;
    }

    form {
        margin: 20px;
        padding: 20px;
        background: var(--white);
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    input[type="file"] {
        padding: 10px;
        border: 2px solid var(--blue);
        border-radius: 5px;
        width: 80%;
        margin-bottom: 20px;
    }

     input[type="text"]{
        padding: 12px;
        border: 2px solid var(--blue);
        border-radius: 5px;
        width: 80%;
        margin-bottom: 20px;
     }

    button {
        width: 100%;
        background: var(--blue);
        color: var(--white);
        padding: 12px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    button:hover {
        background: var(--blue2);
    }

    #result, #download {
        margin: 20px;
        padding: 20px;
        background: var(--white);
        border-radius: 5px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }
</style>

</head>
<body>
    <h1>Image Watermark Tool</h1>
    <form id="formSubmit" enctype="multipart/form-data">
        <table>
            <tr style="text-align:left; width:200px">
                <th>
                    <label for="image">Select Image:</label>
                </th>
                <th>
                    <label for="watermarkType">Choose Watermark Type: </label>
                    <input type="radio" name="watermarkType" value="image" id="watermarkImage" checked>Image
                    <input type="radio" name="watermarkType" value="text" id="watermarkText">Text
                </th>
            </tr>
            <tr>
                <td>
                    <input type="file" name="mainImage" accept="image/*">
                </td>
                <td>
                    <div id="imageInput">
                        <input type="file" name="watermarkImage" accept="image/*">
                    </div>

                    <div id="textInput" style="display: none;">
                        <input type="text" name="textWatermark" placeholder="Enter WaterMark Texts">
                    </div>
                </td>
            </tr>
        </table>
        <button type="submit">Add Watermark</button>
    </form>

    <div id="result">
    </div>

    <div id="download">
    <a id="download-link" href="#" download="resized_image.png" style="display: none;">Download</a>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    const watermarkImage = document.getElementById('watermarkImage');
    const watermarkText = document.getElementById('watermarkText');
    const imageInput = document.getElementById('imageInput');
    const textInput = document.getElementById('textInput');

    watermarkImage.addEventListener('change', () => {
        imageInput.style.display = 'block';
        textInput.style.display = 'none';
        // Set the "required" attribute for imageInput and remove it for textInput
        imageInput.setAttribute('required', 'required');
        textInput.removeAttribute('required');
    });

    watermarkText.addEventListener('change', () => {
        imageInput.style.display = 'none';
        textInput.style.display = 'block';
        // Set the "required" attribute for textInput and remove it for imageInput
        textInput.setAttribute('required', 'required');
        imageInput.removeAttribute('required');
    });

    //-----------------------------------------------------------
    const form = document.getElementById('formSubmit');
    const preview = document.getElementById('result');
    const download = document.getElementById('download-link');

    form.addEventListener('submit',(e)=>{
        e.preventDefault();
        // Check if the form is valid (i.e., required fields are filled)
        if (form.checkValidity()) {
            // Form is valid, proceed with form submission
            console.log('Form is valid. Submitting...');
        } else {
            // Form is not valid, show an error message or handle it accordingly
            console.log('Form is not valid. Please fill in all required fields.');
        }

        const formData = new FormData(form);
        fetch('/', {
            method: 'POST',
            body:formData,
        })
        .then((response) => response.text()) // Convert the response to text
        .then((dataUrl) => {
        // Create an image element and set its src attribute to the data URL
        const imageElement = document.createElement('img');
        imageElement.src = dataUrl;

        // Clear the result container and append the image element
        resultContainer.innerHTML = '';
        resultContainer.appendChild(imageElement);

        // Set the download link's href and display it
        downloadLink.href = dataUrl;
        downloadLink.style.display = 'block';
        })
        .catch((error) => {
        console.error('Error:', error);
        });
    });
});

</script>
</body>
</html>
